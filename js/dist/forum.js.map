{"version":3,"file":"forum.js","mappings":"iHAQe,SAASA,mBAAmBC,WAAoBC,QAC7D,IACEC,KAAKD,OACP,CAAE,MAAOE,GACPC,QAAQC,MAAM,2CACdD,QAAQE,KAAK,sEAAsEN,WAAU,2JAG7FI,QAAQE,KAAK,2LAGbF,QAAQG,MAAMJ,GACdC,QAAQI,UACV,CACF,C,wECrBIC,yBAA2B,CAAC,EAGhC,SAASC,oBAAoBC,GAE5B,IAAIC,EAAeH,yBAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaE,QAGrB,IAAIC,EAASN,yBAAyBE,GAAY,CAGjDG,QAAS,CAAC,GAOX,OAHAE,oBAAoBL,GAAUI,EAAQA,EAAOD,QAASJ,qBAG/CK,EAAOD,OACf,CCrBAJ,oBAAoBO,EAAKF,IACxB,IAAIG,EAASH,GAAUA,EAAOI,WAC7B,IAAOJ,EAAiB,QACxB,IAAM,EAEP,OADAL,oBAAoBU,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,GCLRR,oBAAoBU,EAAI,CAACN,EAASQ,KACjC,IAAI,IAAIC,KAAOD,EACXZ,oBAAoBc,EAAEF,EAAYC,KAASb,oBAAoBc,EAAEV,EAASS,IAC5EE,OAAOC,eAAeZ,EAASS,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3Eb,oBAAoBc,EAAI,CAACK,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,G,8CCAlF,MAAM,EAA+BI,OAAOC,KAAKC,OAAO,a,+BCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,iBCMzC,SAASC,IAEtB,IAAMC,EAAS,SAACC,GACd,IAEEC,OAAOC,YAAcD,OAAOC,aAAe,GAC3CD,OAAOC,YAAYC,KAAK,CAAC,EAC3B,CAAE,MAAOvC,GAGHoC,EAAW,GACbI,WAAW,kBAAML,EAAOC,EAAW,EAAE,EAAE,IAE3C,CACF,EAGAD,EAAO,EACT,CCxBA,MAAM,EAA+BJ,OAAOC,KAAKC,OAAO,+B,0DCEzC,SAASQ,IACtB,OAAOC,IAAAA,MAAUC,UAAmB,eACtC,CCJA,MAAM,EAA+BZ,OAAOC,KAAKC,OAAO,mC,+BCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,mC,+BCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,uC,+BCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,sC,+BCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,4B,+BCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,0B,+BCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,8B,+BCWxDS,IAAAA,aAAiBE,IAAI,YAAa,WAEhC,ICDMC,EACAC,EAEAC,EDFAC,EAAcN,IAAAA,MAAUC,UAAkB,mCAAqC,KAEjFM,EAAkC,GACtC,IACIA,EAAeC,KAAKC,MAAMH,EAC9B,CAAE,MAAOhD,GACLC,QAAQG,MAAM,0DAA2DJ,GACzEiD,EAAe,EACnB,CAEIA,EAAaG,SAAS,YCXpBP,EAASH,IAAAA,MAAUC,UAAU,4BAC7BG,EAASJ,IAAAA,MAAUC,UAAU,+BAE7BI,EAAOM,EAAEC,MAAMT,IAErBU,EAAAA,EAAAA,UAASC,IAAAA,UAAqB,OAAQ,SAAUC,GAC9C,OAAIhB,IAAyBgB,IAG3BJ,EAAAK,IAAA,KACGD,IAEDJ,EAAA,OAAKM,MAAM,SAASC,MAAM,4BACvBb,GAIT,IAEAc,EAAAA,EAAAA,QAAOL,IAAAA,UAAqB,CAAC,WAAY,YAAa,SAA2BM,GAC3ErB,MAEJP,KACAtC,EAAAA,EAAAA,GAAmB,SAAUkD,GAC/B,IDTIG,EAAaG,SAAS,sBEVb,WACb,IAAMP,EAASH,IAAAA,MAAUC,UAAU,uCAC7BG,EAASJ,IAAAA,MAAUC,UAAU,0CAE7BI,EAAOM,EAAEC,MAAMT,IAErBU,EAAAA,EAAAA,UAASQ,IAAAA,UAA0B,OAAQ,SAAgCC,GACzE,GAAIvB,IAAkB,OAAOuB,IAE7B,IAAMC,EAAaC,KAAKD,WAExB,OACEZ,EAAA,OAAKc,UAAU,kBACbd,EAACe,IAAkB,CAACC,MAAO3B,IAAAA,cAC3BW,EAAA,OAAKc,UAAU,6BACZF,EACC,CACEK,IAAAA,UAAyB,CAAEL,WAAAA,IAC3BZ,EAAA,OAAKc,UAAU,aACbd,EAAA,OAAKc,UAAU,sBACbd,EAAA,UAAKkB,IAAUL,KAAKM,eAAeC,aAErCpB,EAAA,OAAKc,UAAU,yBAEbd,EAAA,OAAKO,MAAM,sCAAsCD,MAAM,UACpDZ,GAGF2B,IAAAA,UAAqB,CACpBT,WAAAA,EACAU,OAAQT,KAAKS,OACbC,iBAAkBV,KAAKW,gBAAgBC,KAAKZ,WAMpDb,EAAC0B,IAAgB,OAK3B,IAEAlB,EAAAA,EAAAA,QAAOE,IAAAA,UAA0B,CAAC,WAAY,YAAa,SAAgCD,GACrFrB,MAEJP,KACAtC,EAAAA,EAAAA,GAAmB,yBAA0BkD,GAC/C,EACF,CFvCIkC,GAGE/B,EAAaG,SAAS,WGxBb,WACb,IAAMP,EAASH,IAAAA,MAAUC,UAAU,4BAC7BG,EAASJ,IAAAA,MAAUC,UAAU,+BAE9BE,KAGLgB,EAAAA,EAAAA,QAAOoB,IAAAA,UAA4B,QAAS,WAC1C,IAAIxC,IAAJ,CAEA,IAAMyC,EAASC,SAASC,cAAc,UAEtCF,EAAOf,UAAY,2BACnBe,EAAOG,aAAa,QAAS,UAC7BH,EAAOI,UAAYzC,EAGnB,IAAM0C,EAAaJ,SAASK,cAAc,gBACtCD,GACFA,EAAWE,OAAOP,EAXQ,CAa9B,GAGAxC,IAAAA,QAAYgD,OAAO,WACjB,IAAIjD,IAAJ,CAGA,IAAMyC,EAASC,SAASK,cAAc,oBAClCN,IACFA,EAAOI,UAAYzC,EACnBX,KACAtC,EAAAA,EAAAA,GAAmB,SAAUkD,GAPH,CAS9B,GAGAZ,IACF,CHbIyD,GAGE1C,EAAaG,SAAS,kBIxBb,WACb,IAAMP,EAASH,IAAAA,MAAUC,UAAU,mCAC7BG,EAASJ,IAAAA,MAAUC,UAAU,sCAE7BI,EAAOM,EAAEC,MAAMT,IAErBU,EAAAA,EAAAA,UAASmB,IAAAA,UAAsB,OAAQ,SAAUkB,GAC/C,GAAInD,IAAkB,OAAOmD,IAE7B,IAAMC,EAAQD,IAAeE,SAEvBC,EAAWF,EAAMG,OAAO,SAACC,EAAUC,EAAaC,GACpD,IAAMC,EAAO,GAAHC,OAAOJ,EAAU,CAAAC,IAW3B,OARIC,EAAI,EAAIN,EAAMS,QAAUH,GAAKI,SAAS7D,IAAAA,MAAUC,UAAU,+BAA2C,MAAQ,GAC/GyD,EAAK7D,KACHc,EAAA,SAAOjC,IAAG,YAAc+E,EAAKvC,MAAM,mBACjCP,EAAA,OAAKO,MAAM,mCAAmCb,KAK7CqD,CACT,EAAG,IAWH,MARqE,MAAjE1D,IAAAA,MAAUC,UAAU,0CACtBoD,EAASxD,KACPc,EAAA,SAAOjC,IAAG,6BAAgCwC,MAAM,mBAC9CP,EAAA,OAAKO,MAAM,6EAA6Eb,KAKvFM,EAAA,OAAKc,UAAU,cAAc4B,EACtC,IAEAlC,EAAAA,EAAAA,QAAOa,IAAAA,UAAsB,CAAC,WAAY,YAAa,SAAC8B,GAClD/D,MAEJP,KACAtC,EAAAA,EAAAA,GAAmB,gBAAiBkD,GACtC,EACF,CJnBI2D,GAGExD,EAAaG,SAAS,YK9Bb,WACb,IAAMP,EAASH,IAAAA,MAAUC,UAAU,6BAC7BG,EAASJ,IAAAA,MAAUC,UAAU,gCAEnC,GAAKE,EAAL,CAEA,IAAME,EAAOM,EAAEC,MAAMT,IAKrBgB,EAAAA,EAAAA,QAAOL,IAAAA,UAAqB,eAAgB,SAA2BqC,GACjEpD,KAAqD,SAAjCC,IAAAA,QAAYjB,IAAI,cAHlBY,OAAOqE,YAAc,KAQzCb,EAAMjD,IAAI,YAAaS,EAAA,OAAKO,MAAM,6BAA6Bb,IAAc,IAEjF,IAEAc,EAAAA,EAAAA,QAAOL,IAAAA,UAAqB,CAAC,WAAY,YAAa,WAChDf,KAAqD,SAAjCC,IAAAA,QAAYjB,IAAI,cAGpC0D,SAASK,cAAc,uBACvBtD,KACAtC,EAAAA,EAAAA,GAAmB,UAAWkD,GAEpC,EAzBmB,CA0BrB,CLCI6D,GAGE1D,EAAaG,SAAS,uBMjCb,WACb,IAAMP,EAASH,IAAAA,MAAUC,UAAU,wCAC7BG,EAASJ,IAAAA,MAAUC,UAAU,2CAEnC,GAAKE,EAAL,CAEA,IAAME,EAAOM,EAAEC,MAAMT,GAGRsC,SAASK,cAAc,SAC/BoB,MAAMC,YAAY,2CAA4C,SAKnEhD,EAAAA,EAAAA,QAAOE,IAAAA,UAA0B,eAAgB,SAA2B8B,GACtEpD,KAHkBJ,OAAOqE,YAAc,KAQzCb,EAAMjD,IAAI,YAAaS,EAAA,OAAKO,MAAM,wCAAwCb,GAAa,IAE3F,IAEAc,EAAAA,EAAAA,QAAOE,IAAAA,UAA0B,CAAC,WAAY,YAAa,WACrDtB,KAGA0C,SAASK,cAAc,kCACvBtD,KACAtC,EAAAA,EAAAA,GAAmB,qBAAsBkD,GAE/C,EA7BmB,CA8BrB,CNAIgE,EAEJ,E","sources":["webpack://@hertz/ads/./src/forum/safelyEvalAdScript.ts","webpack://@hertz/ads/webpack/bootstrap","webpack://@hertz/ads/webpack/runtime/compat get default export","webpack://@hertz/ads/webpack/runtime/define property getters","webpack://@hertz/ads/webpack/runtime/hasOwnProperty shorthand","webpack://@hertz/ads/external root \"flarum.core.compat['forum/app']\"","webpack://@hertz/ads/external root \"flarum.core.compat['common/extend']\"","webpack://@hertz/ads/./src/forum/RefreshAds.ts","webpack://@hertz/ads/external root \"flarum.core.compat['forum/components/PostStream']\"","webpack://@hertz/ads/./src/forum/areAdsBypassed.ts","webpack://@hertz/ads/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@hertz/ads/external root \"flarum.core.compat['forum/components/DiscussionHero']\"","webpack://@hertz/ads/external root \"flarum.core.compat['forum/components/DiscussionListPane']\"","webpack://@hertz/ads/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@hertz/ads/external root \"flarum.core.compat['common/helpers/listItems']\"","webpack://@hertz/ads/external root \"flarum.core.compat['forum/ForumApplication']\"","webpack://@hertz/ads/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@hertz/ads/./src/forum/index.ts","webpack://@hertz/ads/./src/forum/InsertHeaderAd.tsx","webpack://@hertz/ads/./src/forum/InsertDiscussionPageHeaderAd.tsx","webpack://@hertz/ads/./src/forum/InsertFooterAd.tsx","webpack://@hertz/ads/./src/forum/InsertBetweenPostsAds.tsx","webpack://@hertz/ads/./src/forum/InsertSidebarAd.tsx","webpack://@hertz/ads/./src/forum/InsertDiscussionSidebarAd.tsx"],"sourcesContent":["/**\n * Evals JS ad code without risking it bricking the forum frontend.\n *\n * **Please note that \"safe\" does not refer to preventing Javascript exploits or XSS attacks.**\n *\n * @param adPosition A name to show for the ad location\n * @param script The Javascript code to be eval-ed\n */\nexport default function safelyEvalAdScript(adPosition: string, script: string): void {\n  try {\n    eval(script);\n  } catch (e) {\n    console.group('[hertz/ads] Failed to execute ad script');\n    console.info(`An exception occurred while evaluating the ad script for location \"${adPosition}\".\n\nTo prevent your forum frontend breaking, we caught the error. Please be aware, however, that this may prevent your ads functioning in some cases.`);\n    console.info(\n      `The stacktrace will be logged below to help you identify the issue. This may reference the ads extension, but the likelihood that the issue lies in there is extraordinarily miniscule.`\n    );\n    console.error(e);\n    console.groupEnd();\n  }\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","declare global {\n  interface Window {\n    adsbygoogle: any[];\n  }\n}\n\nexport default function RefreshAds() {\n  // 定义一个递归函数来尝试加载\n  const pushAd = (attempts: number) => {\n    try {\n      // 确保 adsbygoogle 数组存在\n      window.adsbygoogle = window.adsbygoogle || [];\n      window.adsbygoogle.push({});\n    } catch (e) {\n      // 只有当前端真的有广告容器但 JS 还没加载完时才重试\n      // 最多重试 5 次，每次间隔 1 秒，避免无限死循环\n      if (attempts < 5) {\n        setTimeout(() => pushAd(attempts + 1), 1000);\n      }\n    }\n  };\n\n  // 启动\n  pushAd(0);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/PostStream'];","import app from 'flarum/forum/app';\n\nexport default function areAdsBypassed() {\n  return app.forum.attribute<boolean>('canBypassAds');\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionHero'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListPane'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/listItems'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/ForumApplication'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","import app from 'flarum/forum/app';\nimport type { AdUnitLocations } from 'src/common/AdUnitLocations';\nimport InsertBetweenPostsAds from './InsertBetweenPostsAds';\n\nimport InsertDiscussionPageHeaderAd from './InsertDiscussionPageHeaderAd';\nimport InsertDiscussionSidebarAd from './InsertDiscussionSidebarAd';\nimport InsertFooterAd from './InsertFooterAd';\nimport InsertHeaderAd from './InsertHeaderAd';\nimport InsertSidebarAd from './InsertSidebarAd';\n\n// 修改点：注册 ID 改为 hertz/ads\napp.initializers.add('hertz/ads', () => {\n  // 安全修复：如果设置不存在，默认使用空数组 '[]'，防止 JSON.parse 报错导致白屏\n  const rawSettings = app.forum.attribute<string>('hertz-ads.enabled-ad-locations') || '[]';\n  \n  let enabledSlots: AdUnitLocations[] = [];\n  try {\n      enabledSlots = JSON.parse(rawSettings);\n  } catch (e) {\n      console.error('[hertz/ads] Failed to parse enabled locations settings.', e);\n      enabledSlots = [];\n  }\n\n  if (enabledSlots.includes('header')) {\n    InsertHeaderAd();\n  }\n\n  if (enabledSlots.includes('discussion_header')) {\n    InsertDiscussionPageHeaderAd();\n  }\n\n  if (enabledSlots.includes('footer')) {\n    InsertFooterAd();\n  }\n\n  if (enabledSlots.includes('between_posts')) {\n    InsertBetweenPostsAds();\n  }\n\n  if (enabledSlots.includes('sidebar')) {\n    InsertSidebarAd();\n  }\n\n  if (enabledSlots.includes('discussion_sidebar')) {\n    InsertDiscussionSidebarAd();\n  }\n});","import app from 'flarum/forum/app';\n\nimport { extend, override } from 'flarum/common/extend';\n\nimport IndexPage from 'flarum/forum/components/IndexPage';\n\nimport type * as Mithril from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\n\nexport default function InsertHeaderAd() {\n  const AdCode = app.forum.attribute('hertz-ads.ad-code.header') as string;\n  const Script = app.forum.attribute('hertz-ads.ad-code.header.js') as string;\n\n  const Html = m.trust(AdCode) as ReturnType<Mithril.Static['trust']>;\n\n  override(IndexPage.prototype, 'hero', function (originalHero: () => Mithril.Children): Mithril.Children {\n    if (areAdsBypassed()) return originalHero();\n\n    return (\n      <>\n        {originalHero()}\n        {/* 修改点：类名改为 hertz-ad */}\n        <div align=\"center\" class=\"hertz-ad hertz-ad-header\">\n          {Html}\n        </div>\n      </>\n    );\n  });\n\n  extend(IndexPage.prototype, ['oncreate', 'onupdate'], function (this: IndexPage, returned: any) {\n    if (areAdsBypassed()) return;\n\n    RefreshAds();\n    safelyEvalAdScript('header', Script);\n  });\n}","import app from 'flarum/forum/app';\n\nimport { extend, override } from 'flarum/common/extend';\n\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport DiscussionHero from 'flarum/forum/components/DiscussionHero';\nimport DiscussionListPane from 'flarum/forum/components/DiscussionListPane';\nimport PostStream from 'flarum/forum/components/PostStream';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\n\nimport listItems from 'flarum/common/helpers/listItems';\n\nimport type * as Mithril from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\n\nexport default function InsertDiscussionPageHeaderAd() {\n  const AdCode = app.forum.attribute('hertz-ads.ad-code.discussion_header') as string;\n  const Script = app.forum.attribute('hertz-ads.ad-code.discussion_header.js') as string;\n\n  const Html = m.trust(AdCode) as ReturnType<Mithril.Static['trust']>;\n\n  override(DiscussionPage.prototype, 'view', function (this: DiscussionPage, originalFunc: () => Mithril.Children): Mithril.Children {\n    if (areAdsBypassed()) return originalFunc();\n\n    const discussion = this.discussion;\n\n    return (\n      <div className=\"DiscussionPage\">\n        <DiscussionListPane state={app.discussions} />\n        <div className=\"DiscussionPage-discussion\">\n          {discussion ? (\n            [\n              DiscussionHero.component({ discussion }),\n              <div className=\"container\">\n                <nav className=\"DiscussionPage-nav\">\n                  <ul>{listItems(this.sidebarItems().toArray())}</ul>\n                </nav>\n                <div className=\"DiscussionPage-stream\">\n                  {/* 修改点：类名改为 hertz-ad */}\n                  <div class=\"hertz-ad hertz-ad-discussion-header\" align=\"center\">\n                    {Html}\n                  </div>\n\n                  {PostStream.component({\n                    discussion,\n                    stream: this.stream,\n                    onPositionChange: this.positionChanged.bind(this),\n                  })}\n                </div>\n              </div>,\n            ]\n          ) : (\n            <LoadingIndicator />\n          )}\n        </div>\n      </div>\n    );\n  });\n\n  extend(DiscussionPage.prototype, ['oncreate', 'onupdate'], function (this: DiscussionHero, returned: any) {\n    if (areAdsBypassed()) return;\n\n    RefreshAds();\n    safelyEvalAdScript('discussion page header', Script);\n  });\n}","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport ForumApplication from 'flarum/forum/ForumApplication';\nimport areAdsBypassed from './areAdsBypassed';\nimport RefreshAds from './RefreshAds';\nimport safelyEvalAdScript from './safelyEvalAdScript';\n\nexport default function InsertFooterAd() {\n  const AdCode = app.forum.attribute('hertz-ads.ad-code.footer') as string;\n  const Script = app.forum.attribute('hertz-ads.ad-code.footer.js') as string;\n\n  if (!AdCode) return;\n\n  // 使用 Flarum 标准方式：在应用挂载时插入页脚\n  extend(ForumApplication.prototype, 'mount', () => {\n    if (areAdsBypassed()) return;\n\n    const footer = document.createElement('footer');\n    // 修改点：davwheat-ad -> hertz-ad\n    footer.className = 'hertz-ad hertz-ad-footer';\n    footer.setAttribute('align', 'center');\n    footer.innerHTML = AdCode;\n\n    // 找到页面容器并插入\n    const appContent = document.querySelector('.App-content');\n    if (appContent) {\n      appContent.append(footer);\n    }\n  });\n\n  // 监听路由变化来刷新广告\n  app.history.listen(() => {\n    if (areAdsBypassed()) return;\n    \n    // 修改点：查询选择器也必须改\n    const footer = document.querySelector('.hertz-ad-footer');\n    if (footer) {\n      footer.innerHTML = AdCode;\n      RefreshAds();\n      safelyEvalAdScript('footer', Script);\n    }\n  });\n  \n  // 初始化加载\n  RefreshAds();\n}","import app from 'flarum/forum/app';\n\nimport { extend, override } from 'flarum/common/extend';\n\nimport RefreshAds from './RefreshAds';\nimport PostStream from 'flarum/forum/components/PostStream';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\n\nimport type Mithril from 'mithril';\n\nexport default function InsertBetweenPostsAds() {\n  const AdCode = app.forum.attribute('hertz-ads.ad-code.between_posts') as string;\n  const Script = app.forum.attribute('hertz-ads.ad-code.between_posts.js') as string;\n\n  const Html = m.trust(AdCode) as ReturnType<Mithril.Static['trust']>;\n\n  override(PostStream.prototype, 'view', function (originalView: () => Mithril.Vnode<any, any>): Mithril.Children {\n    if (areAdsBypassed()) return originalView();\n\n    const items = originalView().children as Mithril.Children[];\n\n    const newItems = items.reduce((itemList, currentItem, i) => {\n      const curr = [...itemList, currentItem];\n\n      // 修改点：Key 改为 hertz-ads\n      if (i + 1 < items.length && i % (parseInt(app.forum.attribute('hertz-ads.between-n-posts') as string) || 15) === 0) {\n        curr.push(\n          <aside key={`hertz-ad-${i}`} class=\"PostStream-item\">\n            <div class=\"hertz-ad hertz-ad-between-posts\">{Html}</div>\n          </aside>\n        );\n      }\n\n      return curr;\n    }, [] as any[]);\n\n    // 修改点：Key 改为 hertz-ads\n    if (app.forum.attribute('hertz-ads.enable-ad-after-placeholder') === '1') {\n      newItems.push(\n        <aside key={`hertz-ad-after-placeholder`} class=\"PostStream-item\">\n          <div class=\"hertz-ad hertz-ad-between-posts hertz-ad-between-posts--after-placeholder\">{Html}</div>\n        </aside>\n      );\n    }\n\n    return <div className=\"PostStream\">{newItems}</div>;\n  });\n\n  extend(PostStream.prototype, ['onupdate', 'oncreate'], (originalReturnVal: any) => {\n    if (areAdsBypassed()) return;\n\n    RefreshAds();\n    safelyEvalAdScript('between posts', Script);\n  });\n}","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport type * as Mithril from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport type ItemList from 'flarum/common/utils/ItemList';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\n\nexport default function InsertSidebarAd() {\n  const AdCode = app.forum.attribute('hertz-ads.ad-code.sidebar') as string;\n  const Script = app.forum.attribute('hertz-ads.ad-code.sidebar.js') as string;\n\n  if (!AdCode) return;\n\n  const Html = m.trust(AdCode) as ReturnType<Mithril.Static['trust']>;\n\n  // 辅助函数：检查是否是桌面端\n  const isDesktop = () => window.innerWidth >= 768;\n\n  extend(IndexPage.prototype, 'sidebarItems', function (this: IndexPage, items: ItemList<Mithril.Children>) {\n    if (areAdsBypassed() || app.current.get('routeName') === 'tags') return;\n\n    // Only show sidebar ad on desktop and tablet\n    if (isDesktop()) {\n      // 修改点：davwheat-ad -> hertz-ad\n      items.add('hertz-ads', <div class=\"hertz-ad hertz-ad-sidebar\">{Html}</div>, -1000);\n    }\n  });\n\n  extend(IndexPage.prototype, ['oncreate', 'onupdate'], function (this: IndexPage) {\n    if (areAdsBypassed() || app.current.get('routeName') === 'tags') return;\n\n    // 修改点：查询选择器也必须改\n    if (document.querySelector('.hertz-ad-sidebar')) {\n        RefreshAds();\n        safelyEvalAdScript('sidebar', Script);\n    }\n  });\n}","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport type * as Mithril from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport type ItemList from 'flarum/common/utils/ItemList';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\n\nexport default function InsertDiscussionSidebarAd() {\n  const AdCode = app.forum.attribute('hertz-ads.ad-code.discussion_sidebar') as string;\n  const Script = app.forum.attribute('hertz-ads.ad-code.discussion_sidebar.js') as string;\n\n  if (!AdCode) return;\n\n  const Html = m.trust(AdCode) as ReturnType<Mithril.Static['trust']>;\n\n  // 设置 CSS 变量\n  const root = document.querySelector(':root') as HTMLHtmlElement;\n  root.style.setProperty('--hertz-ads--discussion-sidebar-position', '36px');\n\n  // 辅助函数：判断是否为桌面端 (大于 768px)\n  const isDesktop = () => window.innerWidth >= 768;\n\n  extend(DiscussionPage.prototype, 'sidebarItems', function (this: IndexPage, items: ItemList<Mithril.Children>) {\n    if (areAdsBypassed()) return;\n\n    // 性能优化：用 isDesktop() 替代 getComputedStyle\n    if (isDesktop()) {\n      // 修改点：davwheat-ad -> hertz-ad\n      items.add('hertz-ads', <div class=\"hertz-ad hertz-ad-discussion-sidebar\">{Html}</div>, 1000);\n    }\n  });\n\n  extend(DiscussionPage.prototype, ['oncreate', 'onupdate'], function (this: IndexPage) {\n    if (areAdsBypassed()) return;\n\n    // 修改点：查询选择器也必须改\n    if (document.querySelector('.hertz-ad-discussion-sidebar')) {\n        RefreshAds();\n        safelyEvalAdScript('discussion sidebar', Script);\n    }\n  });\n}"],"names":["safelyEvalAdScript","adPosition","script","eval","e","console","group","info","error","groupEnd","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","RefreshAds","pushAd","attempts","window","adsbygoogle","push","setTimeout","areAdsBypassed","app","attribute","add","AdCode","Script","Html","rawSettings","enabledSlots","JSON","parse","includes","m","trust","override","IndexPage","originalHero","'['","align","class","extend","returned","DiscussionPage","originalFunc","discussion","this","className","DiscussionListPane","state","DiscussionHero","listItems","sidebarItems","toArray","PostStream","stream","onPositionChange","positionChanged","bind","LoadingIndicator","InsertDiscussionPageHeaderAd","ForumApplication","footer","document","createElement","setAttribute","innerHTML","appContent","querySelector","append","listen","InsertFooterAd","originalView","items","children","newItems","reduce","itemList","currentItem","i","curr","concat","length","parseInt","originalReturnVal","InsertBetweenPostsAds","innerWidth","InsertSidebarAd","style","setProperty","InsertDiscussionSidebarAd"],"ignoreList":[],"sourceRoot":""}
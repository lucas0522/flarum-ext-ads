{"version":3,"file":"forum.js","mappings":"iHAQe,SAASA,mBAAmBC,WAAoBC,QAC7D,IACEC,KAAKD,OACP,CAAE,MAAOE,GACPC,QAAQC,MAAM,2CACdD,QAAQE,KAAK,sEAAsEN,WAAU,2JAG7FI,QAAQE,KAAK,2LAGbF,QAAQG,MAAMJ,GACdC,QAAQI,UACV,CACF,C,wECrBIC,yBAA2B,CAAC,EAGhC,SAASC,oBAAoBC,GAE5B,IAAIC,EAAeH,yBAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaE,QAGrB,IAAIC,EAASN,yBAAyBE,GAAY,CAGjDG,QAAS,CAAC,GAOX,OAHAE,oBAAoBL,GAAUI,EAAQA,EAAOD,QAASJ,qBAG/CK,EAAOD,OACf,CCrBAJ,oBAAoBO,EAAKF,IACxB,IAAIG,EAASH,GAAUA,EAAOI,WAC7B,IAAOJ,EAAiB,QACxB,IAAM,EAEP,OADAL,oBAAoBU,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,GCLRR,oBAAoBU,EAAI,CAACN,EAASQ,KACjC,IAAI,IAAIC,KAAOD,EACXZ,oBAAoBc,EAAEF,EAAYC,KAASb,oBAAoBc,EAAEV,EAASS,IAC5EE,OAAOC,eAAeZ,EAASS,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3Eb,oBAAoBc,EAAI,CAACK,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,G,8CCAlF,MAAM,EAA+BI,OAAOC,KAAKC,OAAO,a,+BCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,iBCAlD,EAA+BF,OAAOC,KAAKC,OAAO,+B,+BCAxD,MAAM,EAA+BC,E,+BCMtB,SAASC,IAEtB,IAAMC,EAAS,SAACC,GACd,IAEEC,OAAOC,YAAcD,OAAOC,aAAe,GAC3CD,OAAOC,YAAYC,KAAK,CAAC,EAC3B,CAAE,MAAOxC,GAGHqC,EAAW,GACbI,WAAW,kBAAML,EAAOC,EAAW,EAAE,EAAE,IAE3C,CACF,EAGAD,EAAO,EACT,C,+BCtBe,SAASM,IACtB,OAAOC,IAAAA,MAAUC,UAAmB,eACtC,CCJA,MAAM,EAA+Bb,OAAOC,KAAKC,OAAO,mC,+BCAxD,SAASY,EAAgBC,EAAG9C,GAC1B,OAAO6C,EAAkBvB,OAAOyB,eAAiBzB,OAAOyB,eAAeC,OAAS,SAAUF,EAAG9C,GAC3F,OAAO8C,EAAEG,UAAYjD,EAAG8C,CAC1B,EAAGD,EAAgBC,EAAG9C,EACxB,CCJA,MAAM,EAA+B+B,OAAOC,KAAKC,OAAO,0B,+BCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,oB,ICQlDiB,EAAiB,SAAAC,GAAA,SAAAD,IAAA,OAAAC,EAAAC,MAAA,KAAAC,YAAA,KCPvB,IAAwBP,EAAGzB,IDOJ8B,GCPCL,EDODI,GCNnBtB,UAAYN,OAAOgC,OAAOjC,EAAEO,WAAYkB,EAAElB,UAAU2B,YAAcT,EAAGC,EAAeD,EAAGzB,GDMpE,IAAAmC,EAAAN,EAAAtB,UAkCpB,OAlCoB4B,EACrBC,KAAA,WACE,IAAMC,EAASf,IAAAA,MAAUC,UAAU,4BAEnC,OAAOV,IAAE,MAAO,CACdyB,UAAW,2BACXC,MAAO,CACLC,UAAW,SACXC,QAAS,SACTC,MAAO,OACPC,MAAO,OAEPC,WAAY,cACZC,UAAW,OACXC,OAAQ,KACRC,SAAU,WACVC,QAAS,OACTC,eAAgB,SAChBC,WAAY,SACZC,cAAe,WAEhB,CACDtC,IAAAA,MAAQwB,IAEZ,EAACF,EAEDiB,SAAA,WACE,IAAMC,EAAS/B,IAAAA,MAAUC,UAAU,+BAE/B8B,GACF9E,EAAAA,EAAAA,GAAmB,SAAU8E,GAE7BvC,GAEJ,EAACe,CAAA,CAlCoB,C,wBAASyB,IAqChC,SAASC,IAEL,IADiBjC,IAAAA,MAAUC,UAAkB,mCAAqC,MACpEiC,SAAS,WAERlC,IAAAA,MAAUC,UAAU,4BACnC,CAGA,IAAMkC,EAASC,SAASC,cAAc,iBAAmBD,SAASE,KAClE,GAAKH,EAAL,CAEA,IAAII,EAAaH,SAASI,eAAe,6BAEpCD,EAOGJ,EAAOM,mBAAqBF,GAC5BJ,EAAOO,YAAYH,KAPvBA,EAAaH,SAASO,cAAc,QACzBC,GAAK,4BAChBL,EAAWtB,MAAMG,MAAQ,OACzBe,EAAOO,YAAYH,GACnBhD,IAAAA,MAAQgD,EAAYhC,GATL,CAJA,CAmBvB,CErEA,MAAM,EAA+BnB,OAAOC,KAAKC,OAAO,8B,+BCSxDhC,QAAQuF,IAAI,2CAEZ7C,IAAAA,aAAiB8C,IAAI,gBAAiB,WACpCxF,QAAQuF,IAAI,gDCFZE,EAAAA,EAAAA,UAASC,IAAAA,UAAqB,OAAQ,SAAUC,GAE9C,KADiBjD,IAAAA,MAAUC,UAAkB,mCAAqC,MACpEiC,SAAS,UAAW,OAAOe,IAEzC,GAAIlD,IAAkB,OAAOkD,IAE7B,IAAMlC,EAASf,IAAAA,MAAUC,UAAU,4BACnC,OAAKc,EAEE,CACLkC,IACA1D,IAAA,OAAKyB,UAAU,2BAA2BC,MAAO,CAACC,UAAW,SAAUgC,UAAW,SAC/E3D,IAAAA,MAAQwB,KALOkC,GAQtB,IAIAE,EAAAA,EAAAA,QAAOH,IAAAA,UAAqB,WAAY,WAErC,IADiBhD,IAAAA,MAAUC,UAAkB,mCAAqC,MACpEiC,SAAS,YACnBnC,IAAJ,CAEA,IAAMgC,EAAS/B,IAAAA,MAAUC,UAAU,+BAE/B8B,GACF9E,EAAAA,EAAAA,GAAmB,SAAU8E,GAE7BvC,GAP0B,CAS/B,IChCA2D,EAAAA,EAAAA,QAAOC,IAAAA,UAA0B,OAAQ,SAAUC,GAEjD,IADiBrD,IAAAA,MAAUC,UAAkB,mCAAqC,MACpEiC,SAAS,uBAEnBnC,IAAJ,CAEA,IAAMgB,EAASf,IAAAA,MAAUC,UAAU,uCACnC,GAAKc,EAAL,CAEA,IAGMuC,GAHeC,MAAMC,QAAQH,EAAMI,UAAYJ,EAAMI,SAAW,CAACJ,EAAMI,WAGtCC,KAAK,SAACC,GAAU,OACrDA,GAASA,EAAMC,OAASD,EAAMC,MAAM5C,WAAa2C,EAAMC,MAAM5C,UAAUkB,SAAS,4BAA4B,GAG9G,GAAIoB,GAAqBC,MAAMC,QAAQF,EAAkBG,UAAW,CAClE,IAAMI,EACJtE,IAAA,OAAKyB,UAAU,sCAAsCC,MAAO,CAACC,UAAW,SAAU4C,aAAc,SAC7FvE,IAAAA,MAAQwB,IAGbuC,EAAkBG,SAASM,OAAO,EAAG,EAAGF,EAC1C,CAhBmB,CAHS,CAoB9B,IAEAV,EAAAA,EAAAA,QAAOC,IAAAA,UAA0B,WAAY,WAE3C,IADiBpD,IAAAA,MAAUC,UAAkB,mCAAqC,MACpEiC,SAAS,uBACnBnC,IAAJ,CAEA,IAAMgC,EAAS/B,IAAAA,MAAUC,UAAU,0CAG/B8B,GACF9E,EAAAA,EAAAA,GAAmB,oBAAqB8E,GAExCvC,GAR0B,CAU9B,ILyBA2D,EAAAA,EAAAA,QAAOa,IAAAA,UAAgB,WAAY,WACjClE,WAAWmC,EAAkB,IAC/B,IAEAkB,EAAAA,EAAAA,QAAOa,IAAAA,UAAgB,WAAY,WACjClE,WAAWmC,EAAkB,IAC/B,GMvEa,YAEbkB,EAAAA,EAAAA,QAAOc,IAAAA,UAAsB,OAAQ,SAAUZ,GAE7C,IADiBrD,IAAAA,MAAUC,UAAkB,mCAAqC,MACpEiC,SAAS,mBACnBnC,IAAJ,CAEA,IAAMgB,EAASf,IAAAA,MAAUC,UAAU,mCACnC,GAAKc,EAAL,CAEA,IAAMmD,EAAkBlE,IAAAA,MAAUC,UAA2B,6BACvDkE,EAAWC,SAASC,OAAOH,GAAmB,MAAO,IAC3D,KAAIC,GAAY,GAIhB,IAFA,IAAMG,EAAQjB,EAAMI,SAEXc,EAAID,EAAME,OAAS,EAAGD,EAAI,EAAGA,IACpC,GAAIA,EAAIJ,IAAa,EAAG,CACtB,IAAMN,EACJtE,IAAA,OAAKyB,UAAU,kCAAkCC,MAAO,CAACC,UAAW,WACjE3B,IAAAA,MAAQwB,IAGbuD,EAAMP,OAAOQ,EAAG,EAAGV,EACrB,CAhBiB,CAHS,CAqB9B,GAIA,IAAMY,EAAa,YACAzE,IAAAA,MAAUC,UAAkB,mCAAqC,MACpEiC,SAAS,mBACnBnC,KAIC2E,KAAKC,SAEED,KAAKC,QAAQC,iBAAiB,2BAEtCC,QAAQ,SAAChB,GAEX,GAA2C,SAAvCA,EAAGiB,aAAa,mBAApB,CAKAjB,EAAGkB,aAAa,kBAAmB,QAGnC,IAAMhD,EAAS/B,IAAAA,MAAUC,UAAU,sCAE/B8B,GACF9E,EAAAA,EAAAA,GAAmB,gBAAiB8E,GAEpCvC,GAXF,CAeF,GACF,GAIA2D,EAAAA,EAAAA,QAAOc,IAAAA,UAAsB,WAAYQ,IAGzCtB,EAAAA,EAAAA,QAAOc,IAAAA,UAAsB,WAAYQ,EAC3C,CHzDEO,IIXA7B,EAAAA,EAAAA,QAAOH,IAAAA,UAAqB,eAAgB,SAAUiC,GAEpD,IADiBjF,IAAAA,MAAUC,UAAkB,mCAAqC,MACpEiC,SAAS,aAEnBnC,IAAJ,CAEA,IAAMgB,EAASf,IAAAA,MAAUC,UAAU,6BAC9Bc,GAELkE,EAAMnC,IACJ,mBACAvD,IAAA,OAAKyB,UAAU,4BAA4BC,MAAO,CAACC,UAAW,SAAU4C,aAAc,SACnFvE,IAAAA,MAAQwB,KAEV,IAVyB,CAY9B,IAEAoC,EAAAA,EAAAA,QAAOH,IAAAA,UAAqB,WAAY,WAEtC,IADiBhD,IAAAA,MAAUC,UAAkB,mCAAqC,MACpEiC,SAAS,aAEnBnC,IAAJ,CAEA,IAAMgC,EAAS/B,IAAAA,MAAUC,UAAU,gCAG/B8B,GACF9E,EAAAA,EAAAA,GAAmB,UAAW8E,GAE9BvC,GAR0B,CAU9B,IChCA2D,EAAAA,EAAAA,QAAOC,IAAAA,UAA0B,eAAgB,SAAU6B,GAEzD,IADiBjF,IAAAA,MAAUC,UAAkB,mCAAqC,MACpEiC,SAAS,wBAEnBnC,IAAJ,CAEA,IAAMgB,EAASf,IAAAA,MAAUC,UAAU,wCAC9Bc,GAELkE,EAAMnC,IACJ,8BACAvD,IAAA,OAAKyB,UAAU,uCAAuCC,MAAO,CAACC,UAAW,SAAU4C,aAAc,SAC9FvE,IAAAA,MAAQwB,KAEV,IAVyB,CAY9B,IAEAoC,EAAAA,EAAAA,QAAOC,IAAAA,UAA0B,WAAY,WAE3C,IADiBpD,IAAAA,MAAUC,UAAkB,mCAAqC,MACpEiC,SAAS,wBAEnBnC,IAAJ,CAEA,IAAMgC,EAAS/B,IAAAA,MAAUC,UAAU,2CAG/B8B,GACF9E,EAAAA,EAAAA,GAAmB,qBAAsB8E,GAEzCvC,GAR0B,CAU9B,GLjBAlC,QAAQuF,IAAI,mCACd,E","sources":["webpack://@hertz-dev/ads/./src/forum/safelyEvalAdScript.ts","webpack://@hertz-dev/ads/webpack/bootstrap","webpack://@hertz-dev/ads/webpack/runtime/compat get default export","webpack://@hertz-dev/ads/webpack/runtime/define property getters","webpack://@hertz-dev/ads/webpack/runtime/hasOwnProperty shorthand","webpack://@hertz-dev/ads/external root \"flarum.core.compat['forum/app']\"","webpack://@hertz-dev/ads/external root \"flarum.core.compat['common/extend']\"","webpack://@hertz-dev/ads/external root \"flarum.core.compat['forum/components/PostStream']\"","webpack://@hertz-dev/ads/external assign \"m\"","webpack://@hertz-dev/ads/./src/forum/RefreshAds.ts","webpack://@hertz-dev/ads/./src/forum/areAdsBypassed.ts","webpack://@hertz-dev/ads/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@hertz-dev/ads/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@hertz-dev/ads/external root \"flarum.core.compat['common/components/Page']\"","webpack://@hertz-dev/ads/external root \"flarum.core.compat['common/Component']\"","webpack://@hertz-dev/ads/./src/forum/InsertFooterAd.tsx","webpack://@hertz-dev/ads/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@hertz-dev/ads/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@hertz-dev/ads/./src/forum/index.ts","webpack://@hertz-dev/ads/./src/forum/InsertHeaderAd.tsx","webpack://@hertz-dev/ads/./src/forum/InsertDiscussionPageHeaderAd.tsx","webpack://@hertz-dev/ads/./src/forum/InsertBetweenPostsAds.tsx","webpack://@hertz-dev/ads/./src/forum/InsertSidebarAd.tsx","webpack://@hertz-dev/ads/./src/forum/InsertDiscussionSidebarAd.tsx"],"sourcesContent":["/**\n * Evals JS ad code without risking it bricking the forum frontend.\n *\n * **Please note that \"safe\" does not refer to preventing Javascript exploits or XSS attacks.**\n *\n * @param adPosition A name to show for the ad location\n * @param script The Javascript code to be eval-ed\n */\nexport default function safelyEvalAdScript(adPosition: string, script: string): void {\n  try {\n    eval(script);\n  } catch (e) {\n    console.group('[hertz/ads] Failed to execute ad script');\n    console.info(`An exception occurred while evaluating the ad script for location \"${adPosition}\".\n\nTo prevent your forum frontend breaking, we caught the error. Please be aware, however, that this may prevent your ads functioning in some cases.`);\n    console.info(\n      `The stacktrace will be logged below to help you identify the issue. This may reference the ads extension, but the likelihood that the issue lies in there is extraordinarily miniscule.`\n    );\n    console.error(e);\n    console.groupEnd();\n  }\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/PostStream'];","const __WEBPACK_NAMESPACE_OBJECT__ = m;","declare global {\n  interface Window {\n    adsbygoogle: any[];\n  }\n}\n\nexport default function RefreshAds() {\n  // å®šä¹‰ä¸€ä¸ªé€’å½’å‡½æ•°æ¥å°è¯•åŠ è½½\n  const pushAd = (attempts: number) => {\n    try {\n      // ç¡®ä¿ adsbygoogle æ•°ç»„å­˜åœ¨\n      window.adsbygoogle = window.adsbygoogle || [];\n      window.adsbygoogle.push({});\n    } catch (e) {\n      // åªæœ‰å½“å‰ç«¯çœŸçš„æœ‰å¹¿å‘Šå®¹å™¨ä½† JS è¿˜æ²¡åŠ è½½å®Œæ—¶æ‰é‡è¯•\n      // æœ€å¤šé‡è¯• 5 æ¬¡ï¼Œæ¯æ¬¡é—´éš” 1 ç§’ï¼Œé¿å…æ— é™æ­»å¾ªç¯\n      if (attempts < 5) {\n        setTimeout(() => pushAd(attempts + 1), 1000);\n      }\n    }\n  };\n\n  // å¯åŠ¨\n  pushAd(0);\n}","import app from 'flarum/forum/app';\n\nexport default function areAdsBypassed() {\n  return app.forum.attribute<boolean>('canBypassAds');\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Page'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport Page from 'flarum/common/components/Page';\nimport Component from 'flarum/common/Component';\nimport m from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport safelyEvalAdScript from './safelyEvalAdScript';\n\nclass FooterAdComponent extends Component {\n  view() {\n    const AdCode = app.forum.attribute('hertz-ads.ad-code.footer') as string;\n    \n    return m('div', {\n      className: 'hertz-ad hertz-ad-footer',\n      style: {\n        textAlign: 'center',\n        padding: '20px 0',\n        width: '100%',\n        clear: 'both',\n        // âœ… æ­£å¼æ ·å¼ï¼šé€æ˜èƒŒæ™¯ï¼Œæ— è¾¹æ¡†\n        background: 'transparent', \n        minHeight: '90px', // é¢„ç•™é«˜åº¦ï¼Œé¿å…å¸ƒå±€è·³åŠ¨\n        zIndex: 9999, \n        position: 'relative', \n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        flexDirection: 'column'\n      }\n    }, [\n      m.trust(AdCode)\n    ]);\n  }\n\n  oncreate() {\n    const Script = app.forum.attribute('hertz-ads.ad-code.footer.js') as string;\n    \n    if (Script) {\n      safelyEvalAdScript('footer', Script);\n    } else {\n      RefreshAds();\n    }\n  }\n}\n\nfunction forceMountFooter() {\n    const settings = app.forum.attribute<string>('hertz-ads.enabled-ad-locations') || '[]';\n    if (!settings.includes('footer')) return;\n\n    const AdCode = app.forum.attribute('hertz-ads.ad-code.footer') as string;\n    if (!AdCode) return;\n\n    // ä¼˜å…ˆæ’å…¥åˆ°å†…å®¹åŒºåº•éƒ¨ï¼Œå…¶æ¬¡æ˜¯ Body\n    const target = document.querySelector('.App-content') || document.body;\n    if (!target) return;\n\n    let mountPoint = document.getElementById('hertz-global-footer-mount');\n    \n    if (!mountPoint) {\n        mountPoint = document.createElement('div');\n        mountPoint.id = 'hertz-global-footer-mount';\n        mountPoint.style.width = '100%';\n        target.appendChild(mountPoint);\n        m.mount(mountPoint, FooterAdComponent);\n    } else {\n        if (target.lastElementChild !== mountPoint) {\n            target.appendChild(mountPoint);\n        }\n    }\n}\n\nexport default function InsertFooterAd() {\n  // ç›‘å¬ Page é¡µé¢ç»„ä»¶ï¼Œç¡®ä¿åœ¨é¡µé¢åˆ‡æ¢æ—¶ä¹Ÿèƒ½è§¦å‘\n  extend(Page.prototype, 'oncreate', function () {\n    setTimeout(forceMountFooter, 500); \n  });\n\n  extend(Page.prototype, 'onupdate', function () {\n    setTimeout(forceMountFooter, 500);\n  });\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","import { extend } from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport InsertBetweenPostsAds from './InsertBetweenPostsAds';\nimport InsertDiscussionPageHeaderAd from './InsertDiscussionPageHeaderAd';\nimport InsertDiscussionSidebarAd from './InsertDiscussionSidebarAd';\nimport InsertFooterAd from './InsertFooterAd';\nimport InsertHeaderAd from './InsertHeaderAd';\nimport InsertSidebarAd from './InsertSidebarAd';\n\nconsole.log('ğŸ”¥ [Hertz-Debug] index.ts å·²åŠ è½½ï¼Œç­‰å¾…ç»„ä»¶æ³¨å†Œ...');\n\napp.initializers.add('hertz-dev-ads', () => {\n  console.log('ğŸ”¥ [Hertz-Debug] åˆå§‹åŒ–å™¨å¼€å§‹è¿è¡Œã€‚æ­¤æ—¶ä¸æ£€æŸ¥è®¾ç½®ï¼Œç›´æ¥æ³¨å†Œæ‰€æœ‰ç»„ä»¶ã€‚');\n  \n  // ç›´æ¥æ³¨å†Œæ‰€æœ‰å¹¿å‘Šç»„ä»¶\n  // å…·ä½“çš„â€œå¼€å…³æ£€æŸ¥â€å’Œâ€œè¯»å–ä»£ç â€é€»è¾‘ï¼Œå…¨éƒ¨ä¸‹æ”¾åˆ°ç»„ä»¶å†…éƒ¨å»æ‰§è¡Œ\n  // è¿™æ ·å¯ä»¥é¿å¼€åˆå§‹åŒ–æ—¶ app.forum æ•°æ®æœªå‡†å¤‡å¥½çš„é—®é¢˜\n  InsertHeaderAd();\n  InsertDiscussionPageHeaderAd();\n  InsertFooterAd();\n  InsertBetweenPostsAds();\n  InsertSidebarAd();\n  InsertDiscussionSidebarAd();\n\n  console.log('âœ… [Hertz-Debug] æ‰€æœ‰ç»„ä»¶æ³¨å†Œå®Œæ¯• (æ‡’åŠ è½½æ¨¡å¼)');\n});","import app from 'flarum/forum/app';\nimport { override, extend } from 'flarum/common/extend';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport m from 'mithril';\nimport type * as Mithril from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\n\nexport default function InsertHeaderAd() {\n  override(IndexPage.prototype, 'hero', function (originalHero: () => Mithril.Children): Mithril.Children {\n    const settings = app.forum.attribute<string>('hertz-ads.enabled-ad-locations') || '[]';\n    if (!settings.includes('header')) return originalHero();\n\n    if (areAdsBypassed()) return originalHero();\n\n    const AdCode = app.forum.attribute('hertz-ads.ad-code.header') as string;\n    if (!AdCode) return originalHero();\n\n    return [\n      originalHero(),\n      <div className=\"hertz-ad hertz-ad-header\" style={{textAlign: 'center', marginTop: '15px'}}>\n        {m.trust(AdCode)}\n      </div>\n    ];\n  });\n\n  // âŒ ä¿®æ­£ï¼šå»æ‰äº† 'onupdate'ï¼Œåªä¿ç•™ 'oncreate'\n  // è¿™æ ·å¹¿å‘Šåªä¼šåœ¨é¡µé¢åŠ è½½æ—¶è¯·æ±‚ä¸€æ¬¡ï¼Œä¸ä¼šåå¤è¯·æ±‚å¯¼è‡´æŠ¥é”™\n  extend(IndexPage.prototype, 'oncreate', function (this: IndexPage) {\n     const settings = app.forum.attribute<string>('hertz-ads.enabled-ad-locations') || '[]';\n     if (!settings.includes('header')) return;\n     if (areAdsBypassed()) return;\n\n     const Script = app.forum.attribute('hertz-ads.ad-code.header.js') as string;\n     \n     if (Script) {\n       safelyEvalAdScript('header', Script);\n     } else {\n       RefreshAds();\n     }\n  });\n}","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport m from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\n\nexport default function InsertDiscussionPageHeaderAd() {\n  extend(DiscussionPage.prototype, 'view', function (vnode) {\n    const settings = app.forum.attribute<string>('hertz-ads.enabled-ad-locations') || '[]';\n    if (!settings.includes('discussion_header')) return;\n\n    if (areAdsBypassed()) return;\n\n    const AdCode = app.forum.attribute('hertz-ads.ad-code.discussion_header') as string;\n    if (!AdCode) return;\n\n    const rootChildren = Array.isArray(vnode.children) ? vnode.children : [vnode.children];\n\n    // å¯»æ‰¾å†…éƒ¨å®¹å™¨ï¼Œç²¾å‡†æ’åœ¨æ ‡é¢˜æ ä¸‹æ–¹\n    const discussionContent = rootChildren.find((child: any) => \n      child && child.attrs && child.attrs.className && child.attrs.className.includes('DiscussionPage-discussion')\n    );\n\n    if (discussionContent && Array.isArray(discussionContent.children)) {\n      const ad = (\n        <div className=\"hertz-ad hertz-ad-discussion-header\" style={{textAlign: 'center', marginBottom: '20px'}}>\n          {m.trust(AdCode)}\n        </div>\n      );\n      discussionContent.children.splice(1, 0, ad);\n    }\n  });\n\n  extend(DiscussionPage.prototype, 'oncreate', function () {\n    const settings = app.forum.attribute<string>('hertz-ads.enabled-ad-locations') || '[]';\n    if (!settings.includes('discussion_header')) return;\n    if (areAdsBypassed()) return;\n\n    const Script = app.forum.attribute('hertz-ads.ad-code.discussion_header.js') as string;\n    \n    // âœ… ä¿®å¤ï¼šäº’æ–¥é€»è¾‘\n    if (Script) {\n      safelyEvalAdScript('discussion_header', Script);\n    } else {\n      RefreshAds();\n    }\n  });\n}","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport PostStream from 'flarum/forum/components/PostStream';\nimport m from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\n\nexport default function InsertBetweenPostsAds() {\n  // 1. View é€»è¾‘ï¼šè´Ÿè´£æŠŠå¹¿å‘Šä½â€œæŒ–â€å‡ºæ¥ (ä¿æŒä¸å˜)\n  extend(PostStream.prototype, 'view', function (vnode) {\n    const settings = app.forum.attribute<string>('hertz-ads.enabled-ad-locations') || '[]';\n    if (!settings.includes('between_posts')) return;\n    if (areAdsBypassed()) return;\n\n    const AdCode = app.forum.attribute('hertz-ads.ad-code.between_posts') as string;\n    if (!AdCode) return;\n\n    const settingInterval = app.forum.attribute<string | number>('hertz-ads.between-n-posts');\n    const interval = parseInt(String(settingInterval || '15'), 10);\n    if (interval <= 0) return;\n\n    const posts = vnode.children as m.Vnode[];\n\n    for (let i = posts.length - 1; i > 0; i--) {\n      if (i % interval === 0) {\n        const ad = (\n          <div className=\"hertz-ad hertz-ad-between-posts\" style={{textAlign: 'center'}}>\n            {m.trust(AdCode)}\n          </div>\n        );\n        posts.splice(i, 0, ad);\n      }\n    }\n  });\n\n  // 2. æ ¸å¿ƒé€»è¾‘ï¼šæ™ºèƒ½è§¦å‘å‡½æ•°\n  // è¿™ä¸ªå‡½æ•°ä¼šè‡ªåŠ¨è¯†åˆ«â€œæ–°æ¥çš„â€å¹¿å‘Šï¼Œå¹¶å¿½ç•¥â€œè€å¹¿å‘Šâ€\n  const triggerAds = function(this: PostStream) {\n    const settings = app.forum.attribute<string>('hertz-ads.enabled-ad-locations') || '[]';\n    if (!settings.includes('between_posts')) return;\n    if (areAdsBypassed()) return;\n\n    // è·å–å½“å‰ PostStream ç»„ä»¶ä¸‹çš„æ‰€æœ‰å¹¿å‘Šå®¹å™¨\n    // this.element æ˜¯ç»„ä»¶å¯¹åº”çš„çœŸå® DOM èŠ‚ç‚¹\n    if (!this.element) return;\n    \n    const ads = this.element.querySelectorAll('.hertz-ad-between-posts');\n\n    ads.forEach((ad) => {\n      // ğŸ” æ£€æŸ¥æ ‡è®°ï¼šå¦‚æœè¿™ä¸ªå¹¿å‘Šå·²ç»åˆå§‹åŒ–è¿‡äº†ï¼Œç›´æ¥è·³è¿‡ï¼\n      if (ad.getAttribute('data-hertz-init') === 'true') {\n        return;\n      }\n\n      // ğŸ·ï¸ æ‰“æ ‡è®°ï¼šç«‹åˆ»æ ‡è®°ä¸ºå·²åˆå§‹åŒ–ï¼Œé˜²æ­¢ä¸‹æ¬¡é‡å¤æ‰§è¡Œ\n      ad.setAttribute('data-hertz-init', 'true');\n\n      // ğŸš€ æ‰§è¡ŒåŠ è½½ï¼šåªé’ˆå¯¹è¿™ä¸ªæ–°å¹¿å‘Šä½\n      const Script = app.forum.attribute('hertz-ads.ad-code.between_posts.js') as string;\n      \n      if (Script) {\n        safelyEvalAdScript('between_posts', Script);\n      } else {\n        RefreshAds();\n      }\n      \n      // console.log('âœ… [Hertz-Ads] æ¥¼å±‚é—´å¹¿å‘Šæ–°æ’æ§½å·²å¡«å……');\n    });\n  };\n\n  // 3. åŒæ—¶ç›‘å¬ oncreate å’Œ onupdate\n  // oncreate: è´Ÿè´£é¦–å±çš„å‰å‡ ä¸ªå¹¿å‘Š\n  extend(PostStream.prototype, 'oncreate', triggerAds);\n  \n  // onupdate: è´Ÿè´£æ— é™æ»šåŠ¨åŠ è½½å‡ºæ¥çš„æ–°å¹¿å‘Š\n  extend(PostStream.prototype, 'onupdate', triggerAds);\n}","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport m from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\n\nexport default function InsertSidebarAd() {\n  extend(IndexPage.prototype, 'sidebarItems', function (items) {\n    const settings = app.forum.attribute<string>('hertz-ads.enabled-ad-locations') || '[]';\n    if (!settings.includes('sidebar')) return;\n\n    if (areAdsBypassed()) return;\n\n    const AdCode = app.forum.attribute('hertz-ads.ad-code.sidebar') as string;\n    if (!AdCode) return;\n\n    items.add(\n      'hertz-ad-sidebar',\n      <div className=\"hertz-ad hertz-ad-sidebar\" style={{textAlign: 'center', marginBottom: '20px'}}>\n        {m.trust(AdCode)}\n      </div>,\n      -100\n    );\n  });\n  \n  extend(IndexPage.prototype, 'oncreate', function () {\n    const settings = app.forum.attribute<string>('hertz-ads.enabled-ad-locations') || '[]';\n    if (!settings.includes('sidebar')) return;\n    \n    if (areAdsBypassed()) return;\n\n    const Script = app.forum.attribute('hertz-ads.ad-code.sidebar.js') as string;\n    \n    // âœ… ä¿®å¤ï¼šäº’æ–¥é€»è¾‘\n    if (Script) {\n      safelyEvalAdScript('sidebar', Script);\n    } else {\n      RefreshAds();\n    }\n  });\n}","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport m from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\n\nexport default function InsertDiscussionSidebarAd() {\n  extend(DiscussionPage.prototype, 'sidebarItems', function (items) {\n    const settings = app.forum.attribute<string>('hertz-ads.enabled-ad-locations') || '[]';\n    if (!settings.includes('discussion_sidebar')) return;\n\n    if (areAdsBypassed()) return;\n\n    const AdCode = app.forum.attribute('hertz-ads.ad-code.discussion_sidebar') as string;\n    if (!AdCode) return;\n\n    items.add(\n      'hertz-ad-discussion-sidebar',\n      <div className=\"hertz-ad hertz-ad-discussion-sidebar\" style={{textAlign: 'center', marginBottom: '20px'}}>\n        {m.trust(AdCode)}\n      </div>,\n      -100\n    );\n  });\n\n  extend(DiscussionPage.prototype, 'oncreate', function () {\n    const settings = app.forum.attribute<string>('hertz-ads.enabled-ad-locations') || '[]';\n    if (!settings.includes('discussion_sidebar')) return;\n    \n    if (areAdsBypassed()) return;\n\n    const Script = app.forum.attribute('hertz-ads.ad-code.discussion_sidebar.js') as string;\n    \n    // âœ… ä¿®å¤ï¼šäº’æ–¥é€»è¾‘\n    if (Script) {\n      safelyEvalAdScript('discussion_sidebar', Script);\n    } else {\n      RefreshAds();\n    }\n  });\n}"],"names":["safelyEvalAdScript","adPosition","script","eval","e","console","group","info","error","groupEnd","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","m","RefreshAds","pushAd","attempts","window","adsbygoogle","push","setTimeout","areAdsBypassed","app","attribute","_setPrototypeOf","t","setPrototypeOf","bind","__proto__","FooterAdComponent","_Component","apply","arguments","create","constructor","_proto","view","AdCode","className","style","textAlign","padding","width","clear","background","minHeight","zIndex","position","display","justifyContent","alignItems","flexDirection","oncreate","Script","Component","forceMountFooter","includes","target","document","querySelector","body","mountPoint","getElementById","lastElementChild","appendChild","createElement","id","log","add","override","IndexPage","originalHero","marginTop","extend","DiscussionPage","vnode","discussionContent","Array","isArray","children","find","child","attrs","ad","marginBottom","splice","Page","PostStream","settingInterval","interval","parseInt","String","posts","i","length","triggerAds","this","element","querySelectorAll","forEach","getAttribute","setAttribute","InsertBetweenPostsAds","items"],"ignoreList":[],"sourceRoot":""}